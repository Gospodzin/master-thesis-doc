\subsection*{Wybór punktu referencyjnego do grupowania nieujemnych, znormalizowanych wektorów}
W \cite{tivsp} pokazano, że dla nieujemnych, znormalizowanych wektorów da się dobrać punkt referencyjny tak, że wykorzystanie nierówności trójkąta daje lepsze oszacowanie odległości między punktami niż zastosowanie metody projekcji. Grupowanie nieujemnych, znormalizowanych wektorów jest popularnym problemem, zatem warto przeanalizować jak dobierać punkt referencyjny tak żeby uzyskać jak najlepsze szacowanie odległości między punktami i dzięki temu wydajne grupowanie.\par
\input{assets/figures/ti-angle}

\myhyperref{ti-angle}{Rysunek} pokazuje szacowanie odległości między punktami $ A $ i $ B $ z różnymi pozycjami punktu referencyjnego $ R $. Sama obserwacja uświadamia, że otrzymane szacowanie jest tym lepsze im większy kąt $ \angle{ABR} $. Zgodnie z nierównością trójkąta $ \Delta_{ref\_R}(A,B) = |d(A,R) - d(B,R)| \le d(A,B) $, gdzie $ \Delta_{ref\_R}(A,B) $ oznacza szacowanie odległości za pomocą nierówności trójkąta między punktami $ A $ oraz $ B $ z punktem referencyjnym $ R $, szacowanie odległości nie może być większe niż odległość między punktami $ A $ i $ B $, dlatego zależy nam na maksymalizacji szacowanej odległości. Dokładniejsze określenie zależności wymaga odpowiedniej analizy. Poniżej przedstawiono obliczenia ujawniające zależność dokładności szacowania od doboru punktu referencyjnego. Stosowane rysunki pomocnicze są dwuwymiarowe, ale wyprowadzone zależności stosują się do przestrzeni o każdej wymiarowości, gdyż każde trzy $ n $-wymiarowe punkty leżą na jakiejś dwuwymiarowej płaszczyźnie. Dla uproszczenia założono, że punkt referencyjny znajduje się w stałej odległości $ h $ od prostej wyznaczonej przez punkty $ A $ i $ B $. Zmiana położenia punktu referencyjnego polega na przesunięciu punktu R wzdłuż prostej równoległej do prostej tworzonej przez $ A, B $ o długość $ x $ przy czym zerowe przesunięcie znajduje się po środku między $ A $ i $ B $.\par

\input{assets/calculations/ti-ref-selection}

Wnioski płynące z analizy są następujące. Wraz ze wzrostem $ |h| $ maleje znaczenie członu $ (\frac{d}{2} \pm |x|)^2 $, co powoduje, że wartość szacowania spada, stąd im mniejsza odległość $ |h| $ punktu referencyjnego od prostej opartej na $ A $ i $ B $, tym lepsze szacowanie. Podobnie, zwiększanie wartości $ |x| $ powoduje spadek wpływu $ h $ i zwiększenie wartości szacowania. W szczególności, idealne szacowanie $ \Delta_{ref\_R}(A,B) = d $ można uzyskać w przypadku $ |x| \to +\infty \lor (h=0 \,\land\, |x| \ge \frac{d}{2}) $.\par
Wyciągnięte wnioski stosują się niezależnie od charakterystyki zbioru danych. Należy dobierać punkt referencyjny tak, żeby $ |h| $ było jak najmniejsze oraz $ |x| $ odpowiednio duże. W zbiorze danych mamy do czynienia z wieloma punktami, więc trzeba zastosować zbiorczą miarę jakości parametrów $ x $ oraz $ h $. Zerowa wartość $ h $ dla wszystkich punktów zbioru oznaczałaby, że punkty danych oraz punkt referencyjny leżą na prostej. Na tej podstawie można przyjąć, że im bardziej dane i punkt referencyjny przypominają linię prostą tym lepsza jakość punktu referencyjnego. Prosta, na której powinien być umieszczony punkt referencyjny może być na przykład określona na podstawie kierunku największego bezwzględnego odchylenia od średniej.

\subsubsection*{Wyznaczenie metodami numerycznymi}
Dobór punktu referencyjnego, który zapewni efektywne wykorzystanie metody nierówności trójkąta można określić znajdując takie położenie punktu referencyjnego, które będzie maksymalizować sumę szacowań odległości (\myhyperref{ti:max-ti-d}{wyrażenie}) pomiędzy punktami zbioru danych. Maksymalizacja sumy oszacowań nie zapewnia, że grupowanie zostanie przeprowadzone możliwie najwydajniej. Mimo to z dużym prawdopodobieństwem można oczekiwać, że im większa wartość \myhyperref{ti:max-ti-d}{wyrażenia} tym dokładniejsze są poszczególne szacowania odległości pomiędzy punktami i w następstwie lepsze wykorzystanie nierówności trójkąta.
\begin{equation}
	\frac{1}{2}\sum_{v,w \in D} \Delta_{ref\_R}(v,w)
	\label{ti:max-ti-d}
\end{equation}
O grupowanych danych wiadomo tylko tyle, że są to dodatnie, znormalizowane wektory. Nie można przyjąć żadnych dodatkowych założeń. Aby uzyskane wyniki stosowały się do jak największego zbioru możliwych danych wejściowych obliczenia przeprowadzę na danych o równomiernym rozkładzie na dodatnim wycinku n-wymiarowej sfery.\par
Najlepszym rozwiązaniem byłoby analityczne znalezienie najlepszych położeń punktu referencyjnego, ale nie udało mi się dojść do rozwiązania. Do wyboru pozostają metody numeryczne. Dla każdej $ n $-wymiarowej przestrzeni wylosuję $ N $ punktów o rozkładzie równomiernym na powierzchni dodatniego wycinka sfery. Okazuje się, że wylosowanie punktów o rozkładzie równomiernym na powierzchni sfery jest nietrywialne. Rozwiązanie tego problemu można znaleźć w \cite{pickfromsphere}. Do wygenerowania punktów zastosowałem metodę z wykorzystaniem rozkładu normalnego zmodyfikowaną za pomocą wartości bezwzględnej, tak żeby uzyskać tylko punkty na dodatnim wycinku sfery (\myhyperref{ti:uni-rand-on-sphere}{równanie}). 
\begin{equation}
	D = \Set{ v = \frac{(x_1, x_2, \dots, x_n)}{\,\norm{(x_1, x_2, \dots, x_n)}} | x_i=\abs{y_i} \land y_i \sim \mathcal{N}(0,1) \land i=1,2,\dots,n}
	\label{ti:uni-rand-on-sphere}
\end{equation}
Mając zbiór danych można przejść do opisania wartości \myhyperref{ti:max-ti-d}{wyrażenia}. Poszukiwaną sumę szacowań odległości można uzyskać przez zsumowanie szacowań odległości dla każdej pary punktów w zbiorze danych (\myhyperref{ti:cartesian-sum}{wyrażenie}). Jest to najprostsze rozwiązanie, ale mało wydajne dla dużej liczby punktów, gdyż jego złożoność wynosi $ \mathcal{O}(\abs{D}^2) $.\par
\begin{equation}
	\sum_{(v,w) \in D \times D}\abs{\,\norm{v-r} - \norm{w-r}}
	\label{ti:cartesian-sum}
\end{equation}
Okazuje się, że wartość \myhyperref{ti:max-ti-d}{wyrażenia} można wyznaczyć wydajniej, w czasie $ \mathcal{O}(n\log{n}) $. Najpierw należy wyznaczyć odległości wszystkich punktów zbioru $ D $ od punktu referencyjnego $ r $ i posortować rosnąco otrzymane wartości. Następnie, jeśli znowu chcielibyśmy liczyć sumę jak w \myhyperref{ti:cartesian-sum}{wyrażeniu}, to jeśli $ \norm{w-r} $ przyjmuje najmniejszą wartość z posortowanego zbioru, to wartość pod wartością bezwzględną jest zawsze dodatnia ($ \abs{D} $ razy), ponieważ wartości \norm{v-r} mogą być tylko większe. Dla kolejnego elementu z rosnąco posortowanego ciągu wartość będzie dodatnia $ \abs{D}-1 $ razy, i tak dalej. Tak więc, efektywnie, na wartość sumy złoży się najmniejsza wartość ze znakiem minus $ \abs{D}-1 $ razy (-1 bo raz wyzeruje się sama ze sobą). Kolejny element posortowanego ciągu złoży się na wartość sumy ze znakiem minus $ \abs{D}-2 $ razy oraz $ 1 $ raz ze znakiem plus, skąd efektywnie złoży się $ \abs{D}-3 $ razy ze znakiem minus. Dalej, analogicznie $ k $-ty element składa się na wartość \myhyperref{ti:max-ti-d}{wyrażenia} ze znakiem minus $ \abs{D} - 2k + 1 $ razy lub równoznacznie $ 2k-1-\abs{D} $ razy ze znakiem plus. Opierając się na tych wnioskach można stwierdzić, że wartość \myhyperref{ti:max-ti-d}{wyrażenia} można przedstawić \myhyperref{ti:eff-max-ti-d}{wyrażeniem} (\mbox{$ d_k $ - $ k $-ta} odległość od punktu referencyjnego w rosnąco posortowanym porządku).
\input{assets/algorithms/ti-estimations-sum}
\begin{equation}
	\sum_{k=1}^{\abs{D}}d_k*(2k-1-|D|)
	\label{ti:eff-max-ti-d}
\end{equation}
Kiedy już potrafimy określić wartość \myhyperref{ti:max-ti-d}{wyrażenia} można przystąpić do poszukiwania optymalnego położenia punktu referencyjnego. Poszukiwanie polegać będzie na przeszukaniu przestrzeni możliwych położeń punktów referencyjnych i wybranie takich, które dają największą wartość \myhyperref{ti:max-ti-d}{wyrażenia}. Do przeszukania przestrzeni zastosowałem implementację \textit{fminsearch} pochodzącą z systemu \textit{Octave}. Przykładowe znalezione punkty referencyjne dla $ n $-wymiarowych przestrzeni zostały umieszczone w \myhyperref{ti:eg-ref-p}{tabeli}.
\input{assets/tables/ti-eg-ref-p}
Znalezione maksima są ekstremami lokalnymi, ale na podstawie wielokrotnych testów z różnymi punktami startowymi okazuje się, że większość znalezionych pozycji znajduje się w przybliżeniu na osiach układu współrzędnych jak to widać w \myhyperref{ti:eg-ref-p}{tabeli} (z wyjątkiem $ n=2 $). Wydaje się, że można przyjąć założenie, że punkt referencyjny leży na osi współrzędnych bez znaczącej utraty jakości. Wtedy dla każdej $ n $-wymiarowej przestrzeni należy znaleźć tylko położenie $ r $ na jednej z osi, takie żeby maksymalizować funkcję celu. W rzeczywistości, próby pokazują, że przy założeniu położenia $ r $ na osi współrzędnych tracimy niewiele w stosunku do założenia o dowolności $ r $. W \myhyperref{ti:with-condition-diff}{tabeli} widać, że różnica jest nieznacząca i maleje razem z wymiarowością danych.

\myhyperref{ti:ti-dist-sum-by-dist-from-0}{Rysunek} przedstawia zależność jakości szacowania od położenia punktu referencyjnego na osi. Maksimum znajduje się zaraz przy powierzchni sfery i oddala się wraz ze wzrostem wymiarowości. Co ważne, okazuje się, że nie ma dużego znaczenia jak daleko od sfery znajdzie się punkt, ważne żeby nie umieszczać go wewnątrz sfery.
\input{assets/tables/ti-with-condition-diff}

\input{assets/figures/ti-dist-sum-by-dist-from-0}