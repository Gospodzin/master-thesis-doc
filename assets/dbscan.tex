\section{DBSCAN}
DBSCAN \cite{dbscan} jest popularnym algorytmem grupowania gęstościowego. Najważniejsze jego zalety wymienione przez autorów to tworzenie grup o dowolnym kształcie oraz możliwość doboru parametrów przy niewielkiej wiedzy o zbiorze danych. Grupy tworzone są na podstawie lokalnej gęstości punktu rozumianej jako liczba punktów w tzw. $ \varepsilon $-otoczeniu punktu i mają intuicyjne kształty. Ważną cechą DBSCAN jest też pojęcie punktów szumu, czyli takich, które nie pasują do żadnej grupy. Punkty szumu mogą być cenne, na przykład przy wykrywaniu anomalii.

\subsection{Definicje}

\definition{$ \varepsilon $-otoczenie (ang. $ \varepsilon $-neighbourhood)}\newline
Zakładamy, że grupowany jest zbiór punktów $ D $. Zbiór punktów $ q \in D $, znajdujących się w odległości nie większej niż $ \varepsilon $ od punktu $ p $, nazywa się $ \varepsilon $-otoczeniem punktu $ p $. Dalej $\varepsilon$-otoczenie punktu $ p $ w zbiorze $ D $ będzie oznaczane $ N_{D,\varepsilon}(p) $.
\begin{equation}\label{eq:eps-neighbourhood}
	N_{D,\varepsilon}(p) = \set{q \in D | d(p, q) \le \varepsilon}
\end{equation}

\definition{punkt rdzeniowy (ang. core point) (\myhyperref{fig:core-edge-point}{rysunek})}\newline
Punkt $ p $, który posiada w swoim $ \varepsilon $-otoczeniu $ N_{D,\varepsilon}(p) $ co najmniej \mbox{$ \mu $ punktów} jest nazywany punktem rdzeniowym ($ core_{D,\varepsilon,\mu}(p) $).
\begin{equation}\label{core-point}
	core_{D,\varepsilon,\mu}(p) \iff |N_{D,\varepsilon}(p)| \ge \mu
\end{equation}

\input{assets/figures/core-edge-point}

\definition{bezpośrednia gęstościowa osiągalność (ang. direct density reachability) (\myhyperref{fig:core-edge-point}{rysunek})}\newline
Punkt $ p $ jest bezpośrednio gęstościowo osiągalny z punktu $ q $, jeśli punkt $ q $ jest punktem rdzeniowym i $ p $ znajduje się w $ \varepsilon $-otoczeniu punktu $ q $ ($ dirreach_{D,\varepsilon,\mu}(p, q) $).
\begin{equation} \label{direct-reachability}
	dirreach_{D,\varepsilon,\mu}(p, q) \iff p \in N_{D,\varepsilon}(q) \land core_{D,\varepsilon,\mu}(q)
\end{equation}
To, że $ p $ jest bezpośrednio gęstościowo osiągalny z $ q $, nie implikuje, \mbox{że $ q $ jest} bezpośrednio gęstościowo osiągalny z $ p $. Własność ta może być wyrażona następująco:
\begin{equation} \label{direct-reachability-asymmetry}
	\exists_D\;\neg\forall_{p,q\in D}\;dirreach_{D,\varepsilon,\mu}(p, q) \implies dirreach_{D,\varepsilon,\mu}(q, p)
\end{equation}

\definition{punkt brzegowy (ang. edge point) (\myhyperref{fig:core-edge-point}{rysunek})}\newline
Punkt $ p $, który jest bezpośrednio gęstościowo osiągalny z innego \mbox{punktu $ q $}, ale sam nie jest punktem rdzeniowym, jest nazywany punktem brzegowym ($ edge_{D,\varepsilon,\mu}(p) $).
\begin{equation}\label{edge-point}
	edge_{D,\varepsilon,\mu}(p) \iff \neg core_{D,\varepsilon,\mu}(p) \land \exists_{q\in D}\, dirreach_{D,\varepsilon,\mu}(p,q)
\end{equation}

\definition{gęstościowa osiągalność (ang. density reachability)}\newline
Jeśli w ciągu punktów $ p_1,\dots,p_n \in D $ każdy punkt tego ciągu poza ostatnim jest bezpośrednio gęstościowo osiągalny z punktu następnego, to punkt $ p_1 $ jest gęstościowo osiągalny z $ p_n $ ($ reach_{D,\varepsilon,\mu}(p_1, p_n) $).
\begin{equation}
	\exists_{p_1,\dots,p_n\in D}\,\forall_{i\in\set{1,\dots,n-1}}\,dirreach_{D,\varepsilon,\mu}(p_i, p_{i+1}) \implies reach_{D,\varepsilon,\mu}(p_1, p_n)
\end{equation}

\input{assets/figures/density-reachability}

\definition{gęstościowa łączność (ang. density connectivity)}\newline
Jeśli istnieje taki punkt $ r $, że punkty $ p $ i $ q $ są gęstościowo osiągalne z $ r $, to punkty $ p $ i $ q $ są gęstościowo połączone ($ connect_{D,\varepsilon,\mu}(p, q) $).
\begin{equation}
	connect_{D,\varepsilon,\mu}(p, q) \iff \exists_{r\in D}\,reach_{D,\varepsilon,\mu}(p, r) \land reach_{D,\varepsilon,\mu}(q, r)
\end{equation}

\definition{grupa (ang. cluster)}\newline
Zbiór punktów $ C $ jest grupą w $ D $, jeśli zawiera się w $ D $ i jest zbiorem wszystkich punktów gęstościowo osiągalnych z dowolnego punktu rdzeniowego \mbox{w $ D $}. 
\begin{equation}\label{eq:cluster-def}
C = \set{p \in D | reach_{D,\varepsilon,\mu}(p, q)} \land core_{D,\varepsilon,\mu}(q) \land q \in D
\end{equation}

\definition{szum (ang. noise)}\newline
Punkt $ p $, który nie jest punktem rdzeniowym oraz nie jest bezpośrednio gęstościowo osiągalny z żadnego punktu $q \in D$, nazywa się punktem szumu ($ noise_{D,\varepsilon,\mu}(p) $). 
\begin{equation}
	noise_{D,\varepsilon,\mu}(p) \iff \neg core_{D,\varepsilon,\mu}(p) \land \forall_{q\in D}\,\neg dirreach_{D,\varepsilon,\mu}(p, q)
\end{equation}
	
\subsection{Algorytm}
Na podstawie przedstawionej wcześniej definicji grupy autorzy DBSCAN zaproponowali algorytm grupowania. Wersję tego algorytmu z drobną poprawką prezentuje \myhyperref{alg:dbscan}{algorytm}. Dzięki wprowadzonej poprawce zachowana jest poprawność wyniku, a $ \varepsilon $-otoczenie jest wyznaczane dla każdego punktu tylko raz jak to zaproponowano w \cite{fasterdbscan}, w odróżnieniu od oryginalnej propozycji \cite{dbscan}, gdzie $ \varepsilon $-otoczenie może być wyznaczone więcej niż jeden raz dla tego samego punktu. Dalej nazwa DBSCAN będzie używana w odniesieniu do \myhyperref{alg:dbscan}{algorytmu}.

Okazuje się, że zgodnie z definicją grupy (\myhyperref{eq:cluster-def}{wyrażenie}) punkt $ p $ zbioru danych $ D $ może należeć do więcej niż jednej grupy. Taka sytuacja może mieć miejsce, gdy punkt $ p $ jest gęstościowo osiągalny z punktów rdzeniowych $ q $ i $ r $, ale punkt $ q $ nie jest gęstościowo osiągalny z punktu $ r $. Wtedy punkt $ p $ będzie jednocześnie należał do dwóch różnych grup $ C_1 $ oraz $ C_2 $.
\begin{equation}
  reach_{D,\varepsilon,\mu}(p, q) \land reach_{D,\varepsilon,\mu}(p, r) \land 
  \neg reach_{D,\varepsilon,\mu}(q, r) \implies
  p \in C_1 \cap C_2
\end{equation}
Stąd wynika, że punkt $ p $ musi być punktem brzegowym, ponieważ gdyby był punktem rdzeniowym, to $ q $ i $ r $ byłyby gęstościowo połączone za pośrednictwem $ p $.

Algorytm DBSCAN przypisuje każdy punkt ze zbioru danych do odpowiedniej grupy lub szumu poprzez nadanie punktom właściwych etykiet. Każdemu punktowi jest przypisywana tylko jedna etykieta, więc punkt może należeć do co najwyżej jednej grupy, stąd tworzone grupy nie są ściśle zgodne z definicją grupy (\myhyperref{eq:cluster-def}{wyrażenie}). Punkty brzegowe, które zgodnie z definicją grupy powinny należeć do więcej niż jednej grupy, są przez algorytm DBSCAN przypisywane tylko do jednej z tych grup. Co więcej, to, do której \mbox{z grup} zostanie przypisany punkt brzegowy, zależy od kolejności przetwarzania punktów zbioru danych.

Warto zwrócić uwagę, że $ \varepsilon $-otoczenie może być wyznaczane za pomocą dowolnej miary odległości lub podobieństwa\footnote{w przypadku miary podobieństwa należy w \myhyperref{eq:eps-neighbourhood}{wyrażeniu} zanegować wartość miary lub odwrócić znak nierówności}. Najczęściej stosowane miary to odległość euklidesowa, Manhattan oraz podobieństwo kosinusowe.

\input{assets/algorithms/dbscan}

\subsection{Wydajność}
Najbardziej czasochłonną operacją algorytmu DBSCAN jest wyznaczanie $ \varepsilon $-otoczenia punktu. Dla każdego punktu $ \varepsilon $-otoczenie wyznaczane jest co najwyżej raz\footnote{$ \varepsilon $-otoczenie punktu $ p $ jest wyznaczane tylko, jeśli etykieta punktu $ p $ jest nieokreślona, a  po wyznaczeniu $ \varepsilon $-otoczenia zawsze do $ p $ jest przypisywana etykieta}, dlatego jeśli za operację podstawową przyjmiemy wyznaczanie $ \varepsilon $-otoczenia, to w takim sensie złożoność algorytmu będzie liniowa.

Decydująca dla wydajnego działania DBSCAN jest optymalna implementacja wyznaczania $ \varepsilon $-otoczenia. Naiwnym sposobem otrzymania $ \varepsilon $-otoczenia jest sprawdzenie dla każdego punktu w zbiorze danych, czy znajduje się \mbox{w $ \varepsilon $-otoczeniu} punktu, dla którego jest poszukiwane $ \varepsilon $-otoczenie. Wyznaczanie $ \varepsilon $-otoczenia w ten sposób cechuje jednak liniowa złożoność względem liczby punktów w zbiorze danych, co przekłada się na złożoność kwadratową algorytmu DBSCAN. Istnieją metody pozwalające na wydajniejsze znajdowanie $ \varepsilon $-otoczenia i zostaną omówione w kolejnym rozdziale.

Obliczanie wartości miary odległości lub podobieństwa jest czasochłonnym elementem wyznaczania $ \varepsilon $-otoczenia. Stosowane zazwyczaj miary wymagają liniowej liczby operacji względem wymiarowości zbioru danych. Wprowadza to liniową zależność czasu wyznaczania $ \varepsilon $-otoczenia od wymiarowości zbioru danych. Zakładając, że w podstawowym wariancie DBSCAN liczba operacji wyznaczania $ \varepsilon $-otoczenia jest kwadratowa względem rozmiaru zbioru danych, to za złożoność obliczeniową grupowania zbioru danych D można przyjąć $ \mathcal{O}(dim(D)|D|^2) $.